---
title: "How to Manufacture Your Personality to Gain Friends and Second Dates: A Data-Driven Field Guide for Pathetic People by Pathetic People"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Group members: Beau, Richard, Saad, Kevin

```{r}
library(data.table)
```


# Importing the data
(credit: Beau and Richard)

Speed Dating dataset: https://www.kaggle.com/annavictoria/speed-dating-experiment

Each row of the data represents one date. The primary key is one of the participants in the date, so for each date there are two rows in the dataset.

We imported the data, and then turned the appropriate columns into factors. Missing data were just blank strings, which we encoded as NAs.

For now, we are filtering out rows which do not have complete data (some participants did not include their hometown or undergraduate school, which were used as proxies to quantify wealth and education level). We are probably going to add these partially-full rows back into our analysis as we drop features from our model.

```{r}
# This works if you do the following:
# stick the csv file in the same directory as this Rmd
# in RStudio, go to Session -> Set Work Directory -> To Source File location
project.dir <- getwd()
setwd(project.dir)
file_names <- list.files(file.path(project.dir), pattern="*.csv", full.names=TRUE) 
full_data <- fread(file.path(file_names))


full_data[,c("race_o","field_cd", "race", "goal", "date", "go_out", "career_c", "met", "dec", "length", "numdat_2", "gender", "condtn")] <- lapply(full_data[,c("race_o","field_cd", "race", "goal", "date", "go_out", "career_c", "met", "dec", "length", "numdat_2", "gender", "condtn")], factor)

#income, tuition, and mn_sat have NA values so they aren't numeric

nrow(full_data[complete.cases(full_data[ , c("income","tuition","mn_sat")]),])
nrow(full_data)

#we could look at subset? is there a reason that people left off this information?

#full_data <- nrow(full_data[complete.cases(full_data[ , c("income")]),])
#nrow(full_data[complete.cases(full_data[ , c("mn_sat", "income")]),])
#nrow(full_data[complete.cases(full_data[ , c("tuition", "income")]),])

```

Save current state for easy continuation
(credit: Kev)
```{r}
#setwd()
#saveRDS(full_data, file="full_speed_dating.rds")
full_data <- readRDS("full_speed_dating.rds")
```


# Predicting rate of people liking you with constant fields
(credit: Beau and Richard)


The variable 'dec_o' encodes whether the other person in the date decided they would like a second date with you (1 for yes, 0 for no). We decided to use this as the response variable instead of 'match' because 'match' means that both people mutually liked each other. In particular, for each participant, we took the mean of 'dec_o' as a proxy for desireable-ness.



We defined a new table 'const_attribs' (TODO: give better name) which represents the constant attributes of the participants. For example, from one date to another your age, field of study, and gender do not change. We wanted to see whether we can predict desirable-ness.

attr5_1 
Attractive
sinc5_1
Sincere
int5_1
Intelligent
fun5_1
Fun
amb5_1
Ambitious
```{r}
#  rate that people decide they like you after the speed date
desirableness <- aggregate(dec_o ~ iid,full_data, mean)

#additional explanitory variables
attractive <- aggregate(attr_o ~ iid,full_data, mean)
sincere <- aggregate(sinc_o ~ iid,full_data, mean)
intelligent <- aggregate( intel_o ~ iid,full_data, mean)
fun <- aggregate( fun_o ~ iid,full_data, mean)
ambitious <- aggregate( fun_o ~ iid,full_data, mean)

const_attribs <- full_data[, c("iid","gender","age", "field_cd", "mn_sat", "tuition", "imprace", "income", "goal", "date", "go_out", "career_c", "match_es","sports", "tvsports", "exercise", "dining", "museums", "art", "hiking", "gaming", "clubbing", "reading", "tv", "theater", "movies", "concerts", "music", "shopping", "yoga")]

const_attribs <- const_attribs[!duplicated(const_attribs),]

# binding back together
const_attribs <- merge(desirableness, const_attribs,by="iid")

const_attribs <- Reduce(function(x, y) merge(x, y, all=TRUE), list(attractive, sincere, intelligent,fun,ambitious, const_attribs, desirableness  ))
```

We removed a few columns that had pesky numerical values. We will come back and probably add these back in after fixing that.
```{r}
const_attribs <- const_attribs[, -c(10,11,13) ]
full_const_fit <- lm(dec_o ~ ., data = na.omit(const_attribs))
summary(full_const_fit)


```

```{r}
# since we have a bunch of predictor variables I'm going to run a stepwaise AIC
library(MASS)
step <- stepAIC(full_const_fit, direction="both")
step$anova # display results
```

Reducing our model based on our anova results
```{r}
reduced_const_fit <- lm(dec_o ~ gender + age + field_cd + go_out + sports + tvsports + 
    exercise + art + clubbing + tv + theater, data = na.omit(const_attribs))
summary(reduced_const_fit)

#with peoples scores
reduced_const_fit <- lm(dec_o ~ fun_o + attr_o + gender + age + career_c + tvsports + 
    art + yoga, data = na.omit(const_attribs))

summary(reduced_const_fit)
```


```{r}
pairs(const_attribs[,c("dec_o", "fun_o", "attr_o", "gender","age","career_c", "tvsports","art","yoga")])

#that didn't do shite
par(mfrow = c(2,2))
plot(reduced_const_fit)

```


# Predicting desireable-ness from discrepancies in personality attribute grading

We are interested in how discrepancies between how 

How do you think you measure up?
Please rate your opinion of your own attributes, on a scale of 1-10 (be honest!):
attr3_1 
Attractive
sinc3_1
Sincere
int3_1
Intelligent
fun3_1
Fun
amb3_1
Ambitious

And finally, how do you think others perceive you? 
Please rate yourself how you think others would rate you on each of the following attributes, on a scale of 1-10 (1=awful, 10=great) 
attr5_1 
Attractive
sinc5_1
Sincere
int5_1
Intelligent
fun5_1
Fun
amb5_1
Ambitious

These questions were repeated in a follow-up survey, but we decided to just look at the self-ratings from the day of the event.



################################
^
|
|
our code

DEMILITARIZED ZONE

kevin's code
|
|
v
###########################

Based on the model identified above, I want to help you get a date. 
What attributes predict fun or attractiveness?
Are we any good at knowing how fun/attractive we are?

# So what makes us fun? 

There is strong colinearity among all of the perceived attributes (the more fun you are the more attrictive you are). We will exclude the predictors for now. It is possible that the more attractive you are, the more fun/sincere you are perceived or vice versa.

```{r}
fun_const_fit <- lm(fun_o ~ . -attr_o -sinc_o -intel_o -dec_o, data = na.omit(const_attribs))
summary(fun_const_fit)


```

```{r}
# since we have a bunch of predictor variables I'm going to run a stepwaise AIC
library(MASS)
step <- stepAIC(fun_const_fit, direction="both")
step$anova # display results
```

Reducing our model based on our anova results
```{r}
fun_reduced_const_fit <- lm(fun_o ~ gender + go_out + career_c + sports + exercise + dining + 
    gaming + clubbing + tv + concerts + music, data = na.omit(const_attribs))
summary(fun_reduced_const_fit)
```


```{r}
pairs(const_attribs[,c("fun_o", "gender", "go_out", "career_c", "sports", "exercise", "dining", 
    "gaming", "clubbing", "tv", "concerts", "music")])

#that didn't do shite
par(mfrow = c(2,2))
plot(fun_reduced_const_fit)

```

Does the model come out any better if we go forwards?
```{r}
# I don't want the forward approach to grab the perceived data
smaller_const_attribs <- const_attribs[, -which(names(const_attribs) %in% c("attr_o", "sinc_o", "intel_o", "dec_o")) ]
# since we have a bunch of predictor variables I'm going to run a stepwaise AIC
fun_const_fit_2 <- lm(fun_o ~ 1, data = na.omit(smaller_const_attribs))
summary(fun_const_fit_2)
step <- stepAIC(fun_const_fit_2, direction="forward", scope = list(upper = fun_const_fit, lower = fun_const_fit_2))
step$anova # display results
```

Reducing our model based on our anova results
```{r}
fun_reduced_const_fit_2 <- lm(fun_o ~ go_out + exercise + clubbing + gender + field_cd + tv, data = na.omit(smaller_const_attribs))
summary(fun_reduced_const_fit_2)
```

```{r}
pairs(const_attribs[,c("fun_o", "gender", "go_out", "exercise", "clubbing", "tv", "field_cd")])

#that didn't do shite
par(mfrow = c(2,2))
plot(fun_reduced_const_fit_2)

```

Although these appear statistically significant, the Adj. R. Square for this model is very low and there is not much linear relationship from the predicted values
```{r}
plot(const_attribs$fun_o ~ const_attribs$exercise)
plot(const_attribs$fun_o ~ const_attribs$tv)
plot(const_attribs$fun_o ~ const_attribs$gender)
plot(const_attribs$fun_o ~ const_attribs$go_out)
plot(const_attribs$fun_o ~ const_attribs$clubbing)
plot(const_attribs$fun_o ~ const_attribs$field_cd)
plot(const_attribs$fun_o ~ const_attribs$career_c)
```

Where should we go from here with this idea?

- perceived fun for males is range than for females?
- real estate agents are more fun?
- TO-DO: show plot for correlation between fun and attractiveness
- visually, it is possible that the less you go out (7) the less fun you are
- it could be possible that the more important clubbing is to you, the more fun you are
- t-tests to show which careers, fields of study are more attractive/fun/etc?
- TO-DO: we need to try splitting all of our analyses by genders (what men what/think is different than women... the data is already very binary so this is based on this dataset)
- TO-DO: fix ambitious assignment in Richard and Beau's part
- TO-DO: remove line
- TO-DO: make plots prettier
- TO-DO: do similar thing with attractiveness

# How accurate is our self-perception?

We see that personality traits like fun and attractiveness are correlated with if your speed date decides to say "yes" to you. What does this mean for us as far as what we think about ourselves? Do we even know how fun/attractive we are to others?

Alternatively, are others able to pick up on our less obvious traits, like sincerity and ambition, in 4 minutes?

plot self ratings vs. avg of trait
```{r}
#  rate that people decide they like you after the speed date
desirableness <- aggregate(dec_o ~ iid,full_data, mean)

#additional explanitory variables
attractive <- aggregate(attr_o ~ iid,full_data, mean)
sincere <- aggregate(sinc_o ~ iid,full_data, mean)
intelligent <- aggregate( intel_o ~ iid,full_data, mean)
fun <- aggregate( fun_o ~ iid,full_data, mean)
ambitious <- aggregate( amb_o ~ iid,full_data, mean)

personality_attribs <- full_data[, c("iid", "attr3_1", "sinc3_1", "fun3_1", "intel3_1", "amb3_1")]

personality_attribs <- personality_attribs[!duplicated(personality_attribs),]

# binding back together
personality_attribs <- merge(desirableness, personality_attribs,by="iid")

# we end up with three columns of dec_o here
personality_attribs <- Reduce(function(x, y) merge(x, y, all=TRUE), list(attractive, sincere, intelligent,fun,ambitious, personality_attribs, desirableness  ))


attr_lm <- lm(personality_attribs$attr_o ~ personality_attribs$attr3_1)
summary(attr_lm)

plot(personality_attribs$attr_o ~ personality_attribs$attr3_1)
abline(attr_lm)

library(ggplot2)
personality_attribs$attr3_1 <- as.factor(personality_attribs$attr3_1)
p <- ggplot(personality_attribs, aes(x=attr3_1, y=attr_o, fill=attr3_1)) + 
  geom_violin(trim=FALSE)
# plot with median and quartile
p  + geom_boxplot(width=0.1, fill="white") + labs(title="Perceived Attractiveness", x="Self-Reported", y="Partner Rating") + theme_classic()
# is it possible to add the lm to this plot?
```



```{r}
sinc_lm <- lm(personality_attribs$sinc_o ~ personality_attribs$sinc3_1)
intel_lm <- lm(personality_attribs$intel_o ~ personality_attribs$intel3_1)
fun_lm <- lm(personality_attribs$fun_o ~ personality_attribs$fun3_1)
amb_lm <- lm(personality_attribs$amb_o ~ personality_attribs$amb3_1)

summary(sinc_lm)
summary(intel_lm)
summary(fun_lm)
summary(amb_lm)

par(mfrow = c(2,2))
plot(personality_attribs$sinc_o ~ personality_attribs$sinc3_1)
abline(sinc_lm)
plot(personality_attribs$fun_o ~ personality_attribs$fun3_1)
abline(fun_lm)
plot(personality_attribs$intel_o ~ personality_attribs$intel3_1)
abline(intel_lm)
plot(personality_attribs$amb_o ~ personality_attribs$amb3_1)
abline(amb_lm)
```

```{r}
personality_attribs$sinc3_1 <- as.factor(personality_attribs$sinc3_1)
personality_attribs$fun3_1 <- as.factor(personality_attribs$fun3_1)
personality_attribs$intel3_1 <- as.factor(personality_attribs$intel3_1)
personality_attribs$amb3_1 <- as.factor(personality_attribs$amb3_1)

ggplot(personality_attribs, aes(x=sinc3_1, y=sinc_o, fill=sinc3_1)) + 
  geom_violin(trim=FALSE) + geom_boxplot(width=0.1, fill="white") + labs(title="Perceived Sincerity", x="Self-Reported", y="Partner Rating") + theme_classic()
ggplot(personality_attribs, aes(x=fun3_1, y=sinc_o, fill=fun3_1)) + 
  geom_violin(trim=FALSE) + geom_boxplot(width=0.1, fill="white") + labs(title="Perceived Fun", x="Self-Reported", y="Partner Rating") + theme_classic()
ggplot(personality_attribs, aes(x=intel3_1, y=sinc_o, fill=intel3_1)) + 
  geom_violin(trim=FALSE) + geom_boxplot(width=0.1, fill="white") + labs(title="Perceived Intelligence", x="Self-Reported", y="Partner Rating") + theme_classic()
ggplot(personality_attribs, aes(x=amb3_1, y=sinc_o, fill=amb3_1)) + 
  geom_violin(trim=FALSE) + geom_boxplot(width=0.1, fill="white") + labs(title="Perceived Ambition", x="Self-Reported", y="Partner Rating") + theme_classic()
```

Self-reported trait ratings do not correlate with average partner ratings.

General Takeaway: Turns out.. we kind of suck at predicting how attractive we are to others. What we think about ourselves is not at all correlated to what others see in us. Maybe there is no point to worrying about how strangers see us, because either they don't or we don't.
