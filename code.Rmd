---
title: "How to Manufacture Your Personality to Gain Friends and Second Dates: A Data-Driven Field Guide for Pathetic People by Pathetic People"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Group members: Beau, Richard, Saad, Kevin

```{r}
library(data.table)
```


# Importing the data
(credit: Beau and Richard)

Speed Dating dataset: https://www.kaggle.com/annavictoria/speed-dating-experiment

Each row of the data represents one date. The primary key is one of the participants in the date, so for each date there are two rows in the dataset.

We imported the data, and then turned the appropriate columns into factors. Missing data were just blank strings, which we encoded as NAs.

For now, we are filtering out rows which do not have complete data (some participants did not include their hometown or undergraduate school, which were used as proxies to quantify wealth and education level). We are probably going to add these partially-full rows back into our analysis as we drop features from our model.

```{r}
# This works if you do the following:
# stick the csv file in the same directory as this Rmd
# in RStudio, go to Session -> Set Work Directory -> To Source File location
project.dir <- getwd()
setwd(project.dir)
file_names <- list.files(file.path(project.dir), pattern="*.csv", full.names=TRUE) 
full_data <- fread(file.path(file_names))


full_data[,c("race_o","field_cd", "race", "goal", "date", "go_out", "career_c", "met", "dec", "length", "numdat_2", "gender", "condtn")] <- lapply(full_data[,c("race_o","field_cd", "race", "goal", "date", "go_out", "career_c", "met", "dec", "length", "numdat_2", "gender", "condtn")], factor)

#income, tuition, and mn_sat have NA values so they aren't numeric

nrow(full_data[complete.cases(full_data[ , c("income","tuition","mn_sat")]),])
nrow(full_data)

#we could look at subset? is there a reason that people left off this information?

#full_data <- nrow(full_data[complete.cases(full_data[ , c("income")]),])
#nrow(full_data[complete.cases(full_data[ , c("mn_sat", "income")]),])
#nrow(full_data[complete.cases(full_data[ , c("tuition", "income")]),])

```

Save current state for easy continuation
(credit: Kev)
```{r}
#setwd()
#saveRDS(full_data, file="full_speed_dating.rds")
full_data <- readRDS("full_speed_dating.rds")
```


# Predicting rate of people liking you with constant fields
(credit: Beau and Richard)


The variable 'dec_o' encodes whether the other person in the date decided they would like a second date with you (1 for yes, 0 for no). We decided to use this as the response variable instead of 'match' because 'match' means that both people mutually liked each other. In particular, for each participant, we took the mean of 'dec_o' as a proxy for desireable-ness.



We defined a new table 'const_attribs' (TODO: give better name) which represents the constant attributes of the participants. For example, from one date to another your age, field of study, and gender do not change. We wanted to see whether we can predict desirable-ness.

```{r}
#  rate that people decide they like you after the speed date
desirableness <- aggregate(dec_o ~ iid,full_data, mean)

const_attribs <- full_data[, c("iid","gender","age", "field_cd", "mn_sat", "tuition", "imprace", "income", "goal", "date", "go_out", "career_c", "match_es","sports", "tvsports", "exercise", "dining", "museums", "art", "hiking", "gaming", "clubbing", "reading", "tv", "theater", "movies", "concerts", "music", "shopping", "yoga")]

const_attribs <- const_attribs[!duplicated(const_attribs),]

# binding back together
const_attribs <- merge(desirableness, const_attribs,by="iid")
```

We removed a few columns that had pesky numerical values. We will come back and probably add these back in after fixing that.
```{r}
const_attribs <- const_attribs[, -c(6,7,9) ]
full_const_fit <- lm(dec_o ~ ., data = na.omit(const_attribs))
summary(full_const_fit)


```

```{r}
# since we have a bunch of predictor variables I'm going to run a stepwaise AIC
library(MASS)
step <- stepAIC(full_const_fit, direction="both")
step$anova # display results
```

Reducing our model based on our anova results
```{r}
reduced_const_fit <- lm(dec_o ~ gender + age + field_cd + go_out + sports + tvsports + 
    exercise + art + clubbing + tv + theater, data = na.omit(const_attribs))
summary(reduced_const_fit)
```


```{r}
pairs(const_attribs[,c("dec_o", "gender", "age", "field_cd", "go_out", "sports", "tvsports", "exercise", "art", "clubbing", "tv", "theater")])

#that didn't do shite
par(mfrow = c(2,2))
plot(reduced_const_fit)

```


